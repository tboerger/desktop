# Standards: 1.2
---
- name: Install required packages
  community.general.rpm_ostree_pkg:
    name: "{{ libvirt_required_packages }}"
    state: present
  tags:
    - libvirt

- name: Check boot status
  changed_when: False
  register: libvirt_booted_check
  ansible.builtin.shell: rpm-ostree status --json | jq -r .deployments[0].booted
  tags:
    - libvirt

- name: Live apply changes
  when: libvirt_booted_check.stdout == 'false'
  ansible.builtin.command: rpm-ostree apply-live --allow-replacement
  tags:
    - libvirt

...
